Translating SMC
===============

The various messages contained in SMC that are shown to the user can
be translated so that the final user can use an application that uses
a language he is familar with. For this purpose, SMC employs the [GNU
Gettext library](https://www.gnu.org/software/gettext) that consists
of a specialized internationalization library (`libintl`) and a set of
tools used to manage translation files.

Although it is not required for the translation process, it is
recommended that you have a look at the [Gettext
manual](https://www.gnu.org/software/gettext/manual/gettext.html). It
will explain to you the problems and best practises of
internationalization and make you familiar with the Gettext toolchain.

Glossary
--------

* "i18n" is short for "internationalisation".
* "l10n" is short for "localisation"

Overview
--------

The translations are managed as `.po` files below the
`data/translations` directory, where each available locale is
represented as a single `.po` file containing the two-letter locale
code (e.g. `es` is the Spanish locale). Locale names with four letters
and an underscore denote a specific sublocale that usually slightly
differs from the culture’s canonical locale (e.g. `pt_BR` represents
the Portugese locale as practised in Brazil).

The `.po` files are those you usually do your edits in when you
translate the game. All `.po` files are derived from a master template
file, the `.pot` file (`Secret Maryo Chronicles.pot`) that should
always match the current state of SMC’s sourcecode with regard to new
strings, removed strings, updated strings, etc. Naturally, as SMC
evolves, your `.po` file falls behind the state of SMC’s sourcecode
and thus behind the status denoted by the master `.pot` template
file.

The `.pot` master template file is not intended to be touched by
translators. It is generated by the developers by means of a specific
program, `xgettext`, that parses the SMC sources and updates the
`.pot` file with what it finds there.

How to update a translation
---------------------------

As a translator, the main thing you want to do is probably to
translate strings. As outlined already, you want to work on the `.po`
file for your respective locale therefore. Before you can start with
this, you have to ensure your locale’s `.po` file matches the master
`.pot` template file, and if it doesn’t, merge against it.

If for example you want to update the Spanish locale, you want to work
on the `es.po` file. The first thing to do is to bring it up to date
with the master `.pot` template file, which you can do either by
calling the `msgmerge` program directly or (recommended) by relying on
the Rake tasks the developers defined for you. Change to the directory
containing the `.po` files and execute this:

~~~~~~~~~~~~~~~~~~~~
$ rake es.po
.............................................. done.
~~~~~~~~~~~~~~~~~~~~

Now the `es.po` file is up-to-date and you can start working on
it. This is possible with any editor you are comfortable with, but
there are specialized PO editors such as [Poedit](http://poedit.net/)
or [Emacs with `po-mode`](https://www.gnu.org/software/emacs/) that
will prevent you from violating the PO format accidentally.

The first thing you have to do when working with a `.po` file for the
first time is adapting the PO header, i.e. the translation for the
first `msgid` string right at the top (the one that starts with
`Project-Id-Version`). The first four fields (until
`PO-Revision-Date`) are usually updated by the toolchain and/or your
PO editor, so you should not care about them (especially, **never**
change `POT-Creation-Date` and `Project-Id-Version`). The other fields
might need modification to properly instruct Gettext’s localisation
routines. Most importantly, set the `Language` field to your locale’s
two or four-letter code and set `Content-Type` to `text/plain;
charset=UTF-8` unless you have a very good reason to not use UTF-8 for
your translations. Next you have to tell Gettext how your language
handles pluralization by adding a `Plural-Forms` field to the PO
header as described under section 11.2.6 "Additional functions for
plural forms" of the Gettext manual (skip the part that talks about
the functions, and start with the paragraph that starts with "Now, how
do these functions solve the problem of the plural forms?"). That
section contains a list of useful `Plural-Forms` declarations you can
use. Reading the manual, you find that the `Plural-Forms` declaration
for Spanish is explicitely mentioned there as follows:

~~~~~~~~~~~~~~~~~~~~
Plural-Forms: nplurals=2; plural=n != 1;
~~~~~~~~~~~~~~~~~~~~

The manual also describes what do do if it doesn’t contain an explicit
example for your language. You are then of course required to know
your language’s pluralisation rules very good.

Once done, your PO header should look something like this:

~~~~~~~~~~~~~~~~~~~~
Project-Id-Version: Secret Maryo Chronicles
Report-Msgid-Bugs-To: 
POT-Creation-Date: 2014-08-30 21:36+0200
PO-Revision-Date: 2014-08-30 19:40+0200
Last-Translator: You <you@example.com>
Language-Team: SMC Spanish localization team <smc-es@example.com>
Language: es
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Plural-Forms: nplurals=2; plural=n != 1;
~~~~~~~~~~~~~~~~~~~~

Now you can start translating the rest of the `.po` file.

Note that the comment block right before the PO header’s `msgid` is to
your disposal (except for the copyright notice). You can use it to
introduce your fellow translators to some conventions you use in the
translation or how to contact you, or whatever you judge to be
important. For a German locale, you could for example explain whether
to use the formal `Sie` form of addressing the user or the informal
`Du`.

Don’t forget to add a copyright statement for yourself to the PO
header’s comment block.

In any case, once you have done your edits, verify you did not
introduce PO formatting errors by either running it manually through
`msgfmt` or (recommended) by executing this:

~~~~~~~~~~~~~~~~~~~~
$ rake checkpo
[much output]
~~~~~~~~~~~~~~~~~~~~

You will see error and warning messages if you made a mistake, plus
nice statistics on how much you already translated.

Special cases
-------------

Usually the strings to translate look like this:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ po
#: ../../src/gui/menu_data.cpp:1585
msgid "Enable to play Sounds."
msgstr "Aktiviere um Sounds abzuspielen."
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`msgid` is the key under which the string is looked up, and `mgstr` is
your translation. Occsionally, however, you encounter strings that
look like this:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ po
#. TRANS: Key on a keyboard
#: ../../src/gui/menu_data.cpp:1634
msgid "Key"
msgstr "Taste"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`TRANS` comments are left by the developers and are intended as a help
for translation if a word is not unique.

Or you may find something like this:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ po
#: ../../src/gui/menu_data.cpp:1632 ../../src/gui/menu_data.cpp:1755
msgctxt "action"
msgid "Name"
msgstr "Name"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`msgcxt` lines denote a context in which a word is used. They are used
when the same word (in English) is used with different cases, so that
translators can translate the same word differently depending on the
context.

Sending your translation upstream
---------------------------------

If you want your translation to be included into official SMC, please
do one of the following:

* Open an issue ticket or pull request at
  https://github.com/Secretchronicles/SMC/issues
* Post to the forums at http://smc.quintilianus.eu
* Write an email to me: quintus@quintilianus.eu

Appendix: Generating the POT file
---------------------------------

Use this to have `xgettext` scan through SMC’s sources and update the
POT file:

~~~~~~~~~~~~~~~~~~~~
$ rake potfile
~~~~~~~~~~~~~~~~~~~~
